<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  File: README
  
    &mdash; Documentation by YARD 0.9.26
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" />

  <link rel="stylesheet" href="css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "README";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index</a> &raquo; 
    <span class="title">File: README</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><div id='filecontents'>
<h1 id="label-D0-9C-D0-BE-D0-B4-D1-83-D0-BB-D0-B8+Octoshell">Модули Octoshell</h1>

<p>Octoshell разбит на модули, каждый из которых выполняет свои задачи:
например, модуль hardware управляет информацией о оборудовании
суперкомпьютеров. Каждый модуль реализован с помощью встроенной технологии
Ruby on Rails engines. Этот инструмент предназначен для расширения базового
приложения (в octoshell это практически всё не в директрории engines) новой
функциональностью. Примером является engine RailsAdmin, который позволяется
управлять данными любого проекта на Ruby on Rails. Есть различные модуля
для форумов и т.д. Такие модули чаще всего в Ruby on Rails зависимы только
от базового приложения (модули расширяют его функциональность), а базовое
приложение совсем не зависит от модулей, которые могут быть запросто
удалены/заменены.</p>

<p>Ситуация в Octoshell оказалась иной и разных типов зависимостей было
больше: * зависимости базового приложения от модулей: показать список
отчётов пользователя (модуль Sessions) на его странице в базовом
приложении, ссылки на страницы модулей и многие другие. * зависимости между
модулями: ассоциации моделей из разных модулей.</p>

<p>Octoshell стремится к тому, чтобы любой его модуль мог быть при желании
просто удалён, заменён и изменён (как в СКЦ МГУ, так и в любом другом СКЦ,
который захотел бы использовать Octoshell) Раньше каждая такая операция
могла затронуть другие части Octoshell, пусть элементы разных модулей
взаимодействуют нечасто. Поэтому поверх engines был добавлен новый
механизм, реализованный в модуле Octoface для организации межмодульного
взаимодействия и встраивания модуля в систему.</p>

<h1 id="label-D0-9E-D1-81-D0-BD-D0-BE-D0-B2-D0-BD-D1-8B-D0-B5+-D0-BF-D1-80-D0-B8-D0-BD-D1-86-D0-B8-D0-BF-D1-8B">Основные принципы</h1>

<p>Для каждого принципа реализован один из инструментов модуля Octoface.
Подробнее смотрите в следующих разделах.</p>
<ul><li>
<p>Каждый модуль имеет в системе свою роль: именованный список интерфейсов для
реализации. Например, модуль Support имеет роль support. Если мы хотим
другой модуль для техподдержки, мы можем взять какой-нибудь engine из
Интернета, дать ему роль support и достроить необходимые интерфейсы.</p>
</li><li>
<p>Модули общаются друг с другом с помощью специальных интерфейсов, обращаясь
к имени роли. Если нет модуля, реализующего роль, некорректного обращения
не происходит.</p>
</li><li>
<p>Иногда нужен прямой доступ к элементу другого модуля, например, при
построении ассоциаций в ActiveRecord. Здесь предлагается выполнить
следующие шаги:</p>
</li><li>
<p>“Разрешить” использование класса вне модуля.</p>
</li><li>
<p>За такими разрешенными классами должен осуществляться контроль, поэтому
классы, где они используются, необходимо помечать.</p>
</li><li>
<p>Вызывать методы, зависящие от классов другого модуля, только при условии
наличия необходимого модуля в Octoshell.</p>
</li><li>
<p>Минимальная установка Octoshell состоит из нескольких модулей и базового
приложения, поэтому к многим из их элементов допускается обращаться
напрямую.</p>
<ul><li>
<p>Authentication, который отвечает за аутентификацию и регистрацию
пользователей.</p>
</li><li>
<p>Face, который содержит функциональность, реализующую пользовательский
интерфейс и используемую каждым другим модулем.</p>
</li><li>
<p>Octoface, который реализует взаимодействие между модулями.</p>
</li></ul>
</li><li>
<p>Настройки каждого модуля для интеграции в систему помещаются в файл
lib/&lt;модуль&gt; settings.rb внутри каждого модуля.</p>
</li></ul>

<h1 id="label-D0-98-D0-BD-D1-82-D0-B5-D1-80-D1-84-D0-B5-D0-B9-D1-81-D1-8B">Интерфейсы</h1>

<h2 id="label-settings.rb">settings.rb</h2>

<p>В первую очередь модуль необхомо расширить(extend) с помощью Octoface.
После чего для модуля можно вызвать метод octo_configure, принимающий на
вход Symbol и блок с настройками. После этого за модулем фиксируется
выбранная роль. Пример для модуля Сore с ролью :core “`ruby module Core 
extend Octoface  octo_configure :core do</p>

<p>end end “` Блок с настройками передаётся для исполнения классу
Octoface::OctoConfig, смотрите его документацию для использования его
возможностей.</p>

<h2 id="label-OctoConfig">OctoConfig</h2>

<h2 id="label-D0-98-D0-BD-D1-81-D1-82-D1-80-D1-83-D0-BA-D1-86-D0-B8-D1-8F+-D0-BF-D0-BE+-D1-83-D1-81-D1-82-D0-B0-D0-BD-D0-BE-D0-B2-D0-BA-D0-B5+-D0-B8+-D0-BD-D0-B0-D1-81-D1-82-D1-80-D0-BE-D0-B9-D0-BA-D0-B5-3A">Инструкция по установке и настройке:</h2>

<p>Прежде всего, должны быть установлены модули Core, Support, Face,
Authentication В Gemfile базового приложения дописать</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_gem'>gem</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>pack</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>             <span class='label'>path:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>engines/pack</span><span class='tstring_end'>&#39;</span></span>
</code></pre>

<p>В config/routes.rb базового приложения дописать</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_mount'>mount</span> <span class='const'>Pack</span><span class='op'>::</span><span class='const'>Engine</span><span class='comma'>,</span> <span class='symbol'>:at</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/pack</span><span class='tstring_end'>&quot;</span></span>
</code></pre>

<p>В config/initializers/asets.rb базового приложения дописать</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_application'>application</span><span class='period'>.</span><span class='id identifier rubyid_config'>config</span><span class='period'>.</span><span class='id identifier rubyid_assets'>assets</span><span class='period'>.</span><span class='id identifier rubyid_precompile'>precompile</span> <span class='op'>+=</span> <span class='qwords_beg'>%w(</span><span class='words_sep'> </span><span class='tstring_content'>pack/pack.css</span><span class='words_sep'> </span><span class='tstring_end'>)</span></span>
</code></pre>

<p>В консоли, в корне базового приложения</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_bundle'>bundle</span> <span class='id identifier rubyid_install'>install</span>
</code></pre>

<p>Там же</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_bundle'>bundle</span> <span class='id identifier rubyid_exec'>exec</span> <span class='id identifier rubyid_rake'>rake</span>  <span class='label'>pack:</span><span class='id identifier rubyid_install'>install</span>
</code></pre>

<p>В app/assets/javascripts/application.js дописать:</p>

<pre class="code ruby"><code class="ruby">//= require pack/application
</code></pre>

<p>В app/decorators/controllers/application_controller_decorator.rb дописать:</p>

<p>В методе user_submenu_items:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_menu'>menu</span><span class='period'>.</span><span class='id identifier rubyid_add_item'>add_item</span><span class='lparen'>(</span><span class='const'>Face</span><span class='op'>::</span><span class='const'>MenuItem</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='lbrace'>{</span><span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Пакеты</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
                                      <span class='label'>url:</span> <span class='id identifier rubyid_pack'>pack</span><span class='period'>.</span><span class='id identifier rubyid_root_path'>root_path</span><span class='comma'>,</span>
                                      <span class='label'>regexp:</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>pack</span><span class='regexp_end'>/</span></span><span class='rbrace'>}</span><span class='rparen'>)</span><span class='rparen'>)</span>
</code></pre>

<p>В методе admin_submenu_items: “`ruby</p>

<p>menu.add_item(Face::MenuItem.new(“Пакеты”,  url:
pack.admin_root_path,  regexp: /pack/admin/)) if can? :manage, :packages</p>

<pre class="code ruby"><code class="ruby">
Также добавить в очередь sidekiq:
</code></pre>

<p>bash  -q pack_worker “`</p>

<p>В whenever(config/schedule.rb): “`ruby</p>

<p>every 1.day do  rake “pack:expired”</p>

<p>end “`</p>

<p>Добавить в config/locales/ru.yml</p>

<p>packages:  manage: Полный доступ к Пакетам</p>

<p>Для того,чтобы работала аякс пагинация,нужно поправить view для каминари:</p>

<p>В app/views/kaminari</p>

<p>Везде добавить opts = { remote: remote}</p>

<p>Пример:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_link_to'>link_to</span> <span class='id identifier rubyid_raw'>raw</span><span class='lparen'>(</span><span class='id identifier rubyid_t'>t</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>views.pagination.first</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id identifier rubyid_url'>url</span><span class='comma'>,</span><span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> <span class='lbrace'>{</span> <span class='label'>remote:</span> <span class='id identifier rubyid_remote'>remote</span><span class='rbrace'>}</span>
</code></pre>

<p>В engines/support/app/views/support/admin/tickets/show.html.slim в любом
разумном месте дописать следующее:</p>

<pre class="code ruby"><code class="ruby">= link_to t(&quot;actions.edit_access&quot;), pack.admin_access_path(@ticket.pack_accesses.first), class: &quot;btn btn-default&quot;  if @ticket.pack_accesses.exists?
</code></pre>

<p>Это нужно для того,чтобы администратор из тикета сразу мог перейти к
редактированию доступа.</p>

<p>This project uses MIT-LICENSE.</p>
</div></div>

      <div id="footer">
  Generated on Sat Jun 26 20:23:14 2021 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.26 (ruby-2.5.0).
</div>

    </div>
  </body>
</html>