join_dependency = ActiveRecord::Associations::JoinDependency.new(
        Core::Organization,
        {projects: {organization: :projects }},
        []
        # {:a => :b}
			)


# puts join_dependency.
# join_dependency2 = ActiveRecord::Associations::JoinDependency.new(
#         Core::Organization,
#         [:members],
#         []
# 			)
#

def tables(node)
  puts "----"
  puts node.instance_variable_get("@tables").inspect
  puts (node.instance_variable_get("@tables") || []).first.instance_variable_get("@aliases").inspect.red
  node.children.each do |child|
    # puts "----"
    # puts child.instance_variable_get("@tables").inspect
    tables(child)
  end
end

tables(join_dependency.join_root)

# puts Core::Organization.joins(projects: :organization).to_sql
# puts join_dependency.join_root.inspect
# join_dependency.join_constrainsts join_dependency2
# a = Core::Organization.joins(join_dependency)
# a.join_sources[0].instance_variable_set("@table_allias", 'fun')
# puts a.to_sql
#
# puts Core::Organization.joins(join_dependency).to_sql



#<ActiveRecord::Associations::JoinDependency::JoinBase:0x000056408a673330 @base_klass=Core::Organization(id: integer, name: string, abbreviation: string, kind_id: integer, country_id: integer, city_id: integer, created_at: datetime, updated_at: datetime, checked: boolean), @children=[#<ActiveRecord::Associations::JoinDependency::JoinAssociation:0x000056408a673358 @join_type=Arel::Nodes::InnerJoin, @base_klass=Core::Project(id: integer, title: string, state: string, created_at: datetime, updated_at: datetime, organization_id: integer, organization_department_id: integer, kind_id: integer, first_activation_at: datetime, finished_at: datetime, estimated_finish_date: datetime), @children=[#<ActiveRecord::Associations::JoinDependency::JoinAssociation:0x000056408a673380 @join_type=Arel::Nodes::InnerJoin, @base_klass=Core::Organization(id: integer, name: string, abbreviation: string, kind_id: integer, country_id: integer, city_id: integer, created_at: datetime, updated_at: datetime, checked: boolean), @children=[#<ActiveRecord::Associations::JoinDependency::JoinAssociation:0x000056408a6733f8 @join_type=Arel::Nodes::InnerJoin, @base_klass=Core::Project(id: integer, title: string, state: string, created_at: datetime, updated_at: datetime, organization_id: integer, organization_department_id: integer, kind_id: integer, first_activation_at: datetime, finished_at: datetime, estimated_finish_date: datetime), @children=[], @reflection=#<ActiveRecord::Reflection::HasManyReflection:0x000056408a6f5150 @name=:projects, @scope=nil, @options={:inverse_of=>:organization}, @active_record=Core::Organization(id: integer, name: string, abbreviation: string, kind_id: integer, country_id: integer, city_id: integer, created_at: datetime, updated_at: datetime, checked: boolean), @klass=Core::Project(id: integer, title: string, state: string, created_at: datetime, updated_at: datetime, organization_id: integer, organization_department_id: integer, kind_id: integer, first_activation_at: datetime, finished_at: datetime, estimated_finish_date: datetime), @plural_name="projects", @automatic_inverse_of=nil, @type=nil, @foreign_type="projects_type", @constructable=true, @association_scope_cache={}, @scope_lock=#<Thread::Mutex:0x000056408a6f4ef8>, @class_name="Project", @inverse_of=#<ActiveRecord::Reflection::BelongsToReflection:0x0000564088949598 @name=:organization, @scope=nil, @options={}, @active_record=Core::Project(id: integer, title: string, state: string, created_at: datetime, updated_at: datetime, organization_id: integer, organization_department_id: integer, kind_id: integer, first_activation_at: datetime, finished_at: datetime, estimated_finish_date: datetime), @klass=Core::Organization(id: integer, name: string, abbreviation: string, kind_id: integer, country_id: integer, city_id: integer, created_at: datetime, updated_at: datetime, checked: boolean), @plural_name="organizations", @automatic_inverse_of=false, @type=nil, @foreign_type="organization_type", @constructable=true, @association_scope_cache={}, @scope_lock=#<Thread::Mutex:0x00005640889492c8>, @class_name="Organization">>, @tables=[#<Arel::Nodes::TableAlias:0x000056408a6716c0 @left=#<Arel::Table:0x000056408a671710 @name="core_projects", @engine=ActiveRecord::Base, @columns=nil, @aliases=[#<Arel::Nodes::TableAlias:0x000056408a6716c0 ...>], @table_alias=nil, @primary_key=nil>, @right="projects_core_organizations">]>], @reflection=#<ActiveRecord::Reflection::BelongsToReflection:0x0000564088949598 @name=:organization, @scope=nil, @options={}, @active_record=Core::Project(id: integer, title: string, state: string, created_at: datetime, updated_at: datetime, organization_id: integer, organization_department_id: integer, kind_id: integer, first_activation_at: datetime, finished_at: datetime, estimated_finish_date: datetime), @klass=Core::Organization(id: integer, name: string, abbreviation: string, kind_id: integer, country_id: integer, city_id: integer, created_at: datetime, updated_at: datetime, checked: boolean), @plural_name="organizations", @automatic_inverse_of=false, @type=nil, @foreign_type="organization_type", @constructable=true, @association_scope_cache={}, @scope_lock=#<Thread::Mutex:0x00005640889492c8>, @class_name="Organization">, @tables=[#<Arel::Nodes::TableAlias:0x000056408a671990 @left=#<Arel::Table:0x000056408a6719e0 @name="core_organizations", @engine=ActiveRecord::Base, @columns=nil, @aliases=[#<Arel::Nodes::TableAlias:0x000056408a671990 ...>], @table_alias=nil, @primary_key=nil>, @right="organizations_core_projects">]>], @reflection=#<ActiveRecord::Reflection::HasManyReflection:0x000056408a6f5150 @name=:projects, @scope=nil, @options={:inverse_of=>:organization}, @active_record=Core::Organization(id: integer, name: string, abbreviation: string, kind_id: integer, country_id: integer, city_id: integer, created_at: datetime, updated_at: datetime, checked: boolean), @klass=Core::Project(id: integer, title: string, state: string, created_at: datetime, updated_at: datetime, organization_id: integer, organization_department_id: integer, kind_id: integer, first_activation_at: datetime, finished_at: datetime, estimated_finish_date: datetime), @plural_name="projects", @automatic_inverse_of=nil, @type=nil, @foreign_type="projects_type", @constructable=true, @association_scope_cache={}, @scope_lock=#<Thread::Mutex:0x000056408a6f4ef8>, @class_name="Project", @inverse_of=#<ActiveRecord::Reflection::BelongsToReflection:0x0000564088949598 @name=:organization, @scope=nil, @options={}, @active_record=Core::Project(id: integer, title: string, state: string, created_at: datetime, updated_at: datetime, organization_id: integer, organization_department_id: integer, kind_id: integer, first_activation_at: datetime, finished_at: datetime, estimated_finish_date: datetime), @klass=Core::Organization(id: integer, name: string, abbreviation: string, kind_id: integer, country_id: integer, city_id: integer, created_at: datetime, updated_at: datetime, checked: boolean), @plural_name="organizations", @automatic_inverse_of=false, @type=nil, @foreign_type="organization_type", @constructable=true, @association_scope_cache={}, @scope_lock=#<Thread::Mutex:0x00005640889492c8>, @class_name="Organization">>, @tables=[#<Arel::Table:0x000056408a6721d8 @name="core_projects", @engine=ActiveRecord::Base, @columns=nil, @aliases=[], @table_alias=nil, @primary_key=nil>]>]>



#<ActiveRecord::Associations::JoinDependency::JoinBase:0x0000560a75a62e28 @base_klass=Core::Organization(id: integer, name: string, abbreviation: string, kind_id: integer, country_id: integer, city_id: integer, created_at: datetime, updated_at: datetime, checked: boolean), @children=[#<ActiveRecord::Associations::JoinDependency::JoinAssociation:0x0000560a75a62e78 @join_type=Arel::Nodes::InnerJoin, @base_klass=Core::Project(id: integer, title: string, state: string, created_at: datetime, updated_at: datetime, organization_id: integer, organization_department_id: integer, kind_id: integer, first_activation_at: datetime, finished_at: datetime, estimated_finish_date: datetime), @children=[#<ActiveRecord::Associations::JoinDependency::JoinAssociation:0x0000560a75a62ea0 @join_type=Arel::Nodes::InnerJoin, @base_klass=Core::Organization(id: integer, name: string, abbreviation: string, kind_id: integer, country_id: integer, city_id: integer, created_at: datetime, updated_at: datetime, checked: boolean), @children=[#<ActiveRecord::Associations::JoinDependency::JoinAssociation:0x0000560a75a62ef0 @join_type=Arel::Nodes::InnerJoin, @base_klass=Core::Project(id: integer, title: string, state: string, created_at: datetime, updated_at: datetime, organization_id: integer, organization_department_id: integer, kind_id: integer, first_activation_at: datetime, finished_at: datetime, estimated_finish_date: datetime), @children=[], @reflection=#<ActiveRecord::Reflection::HasManyReflection:0x0000560a75aa71e0 @name=:projects, @scope=nil, @options={:inverse_of=>:organization}, @active_record=Core::Organization(id: integer, name: string, abbreviation: string, kind_id: integer, country_id: integer, city_id: integer, created_at: datetime, updated_at: datetime, checked: boolean), @klass=Core::Project(id: integer, title: string, state: string, created_at: datetime, updated_at: datetime, organization_id: integer, organization_department_id: integer, kind_id: integer, first_activation_at: datetime, finished_at: datetime, estimated_finish_date: datetime), @plural_name="projects", @automatic_inverse_of=nil, @type=nil, @foreign_type="projects_type", @constructable=true, @association_scope_cache={}, @scope_lock=#<Thread::Mutex:0x0000560a75aa6f60>, @class_name="Project", @inverse_of=#<ActiveRecord::Reflection::BelongsToReflection:0x0000560a73cd4cd0 @name=:organization, @scope=nil, @options={}, @active_record=Core::Project(id: integer, title: string, state: string, created_at: datetime, updated_at: datetime, organization_id: integer, organization_department_id: integer, kind_id: integer, first_activation_at: datetime, finished_at: datetime, estimated_finish_date: datetime), @klass=Core::Organization(id: integer, name: string, abbreviation: string, kind_id: integer, country_id: integer, city_id: integer, created_at: datetime, updated_at: datetime, checked: boolean), @plural_name="organizations", @automatic_inverse_of=false, @type=nil, @foreign_type="organization_type", @constructable=true, @association_scope_cache={}, @scope_lock=#<Thread::Mutex:0x0000560a73cd4a00>, @class_name="Organization">>, @tables=[#<Arel::Nodes::TableAlias:0x0000560a75a61370 @left=#<Arel::Table:0x0000560a75a613c0 @name="core_projects", @engine=ActiveRecord::Base, @columns=nil, @aliases=[#<Arel::Nodes::TableAlias:0x0000560a75a61370 ...>], @table_alias=nil, @primary_key=nil>, @right="projects_core_organizations">]>], @reflection=#<ActiveRecord::Reflection::BelongsToReflection:0x0000560a73cd4cd0 @name=:organization, @scope=nil, @options={}, @active_record=Core::Project(id: integer, title: string, state: string, created_at: datetime, updated_at: datetime, organization_id: integer, organization_department_id: integer, kind_id: integer, first_activation_at: datetime, finished_at: datetime, estimated_finish_date: datetime), @klass=Core::Organization(id: integer, name: string, abbreviation: string, kind_id: integer, country_id: integer, city_id: integer, created_at: datetime, updated_at: datetime, checked: boolean), @plural_name="organizations", @automatic_inverse_of=false, @type=nil, @foreign_type="organization_type", @constructable=true, @association_scope_cache={}, @scope_lock=#<Thread::Mutex:0x0000560a73cd4a00>, @class_name="Organization">, @tables=[#<Arel::Nodes::TableAlias:0x0000560a75a615a0 @left=#<Arel::Table:0x0000560a75a615f0 @name="core_organizations", @engine=ActiveRecord::Base, @columns=nil, @aliases=[#<Arel::Nodes::TableAlias:0x0000560a75a615a0 ...>], @table_alias=nil, @primary_key=nil>, @right="organizations_core_projects">]>], @reflection=#<ActiveRecord::Reflection::HasManyReflection:0x0000560a75aa71e0 @name=:projects, @scope=nil, @options={:inverse_of=>:organization}, @active_record=Core::Organization(id: integer, name: string, abbreviation: string, kind_id: integer, country_id: integer, city_id: integer, created_at: datetime, updated_at: datetime, checked: boolean), @klass=Core::Project(id: integer, title: string, state: string, created_at: datetime, updated_at: datetime, organization_id: integer, organization_department_id: integer, kind_id: integer, first_activation_at: datetime, finished_at: datetime, estimated_finish_date: datetime), @plural_name="projects", @automatic_inverse_of=nil, @type=nil, @foreign_type="projects_type", @constructable=true, @association_scope_cache={}, @scope_lock=#<Thread::Mutex:0x0000560a75aa6f60>, @class_name="Project", @inverse_of=#<ActiveRecord::Reflection::BelongsToReflection:0x0000560a73cd4cd0 @name=:organization, @scope=nil, @options={}, @active_record=Core::Project(id: integer, title: string, state: string, created_at: datetime, updated_at: datetime, organization_id: integer, organization_department_id: integer, kind_id: integer, first_activation_at: datetime, finished_at: datetime, estimated_finish_date: datetime), @klass=Core::Organization(id: integer, name: string, abbreviation: string, kind_id: integer, country_id: integer, city_id: integer, created_at: datetime, updated_at: datetime, checked: boolean), @plural_name="organizations", @automatic_inverse_of=false, @type=nil, @foreign_type="organization_type", @constructable=true, @association_scope_cache={}, @scope_lock=#<Thread::Mutex:0x0000560a73cd4a00>, @class_name="Organization">>, @tables=[#<Arel::Table:0x0000560a75a61bb8 @name="core_projects", @engine=ActiveRecord::Base, @columns=nil, @aliases=[], @table_alias=nil, @primary_key=nil>]>]>
